`ssh_cmds`
----------

**类型:** `array`

**值:** `["<cmd-str>", "<cmd-str>", ... , "<cmd-str>"]`

**属性:** [`key`](key.md) 如果定义为 `ssh` ，则 [`value`](value.md) 只能是 [`ssh_cmds`](ssh_cmds.md)

**父节点:** 无

`ssh` 远程执行的命令列表。`<cmd-str>` 代表标准的 linux 命令。

如果需要执行复杂的命令，例如带有条件分支或者循环，可以写成一个单独的脚本，然后在 `<cmd-str>` 列表中加入脚本的执行代码：

    [
        {
	        "key": "scp",
	        "value":
	        [
                ......
	            { "local": "upgrade.sh", "remote": "/data/tmp/" }
                ......
	        ]
	    },
	    {
	        "key": "ssh",
	        "value":
	        [
	            ......
	            "sh upgrader.sh"
                ......
	        ]
	    }
        ......
	]

**特殊标签:** `@index_place_holder`

如果在 `<cmd-str>` 中配置了 `@index_place_holder` ，则 `deploygen` 会根据 `host_file` 中各个机器出现的次序 **依次将该标签替换为对应的序号** 。

例如，将 `deploy.json` 配置为如下内容：

    [
        {
            "key": "scp",
            "value":
            [
                { "local": "zookeeper-3.4.8.tar.gz", "remote": "/data/" }
            ]
        },
        {
            "key": "ssh",
            "value":
            [
                "cd /data",
                "test -d zookeeper-3.4.8 && mv zookeeper-3.4.8 zookeeper-3.4.8-old",
                "tar -zxf zookeeper-3.4.8.tar.gz -C ."
            ]
        },
        {
            "key": "scp",
            "value":
            [
                { "local": "zoo.cfg", "remote": "/data/zookeeper-3.4.8/conf/" }
            ]
        },
        {
            "key": "ssh",
            "value":
            [
                "cd /data/zookeeper-3.4.8",
                "mkdir -p data",
                "cd data/",
                "echo \"@index_place_holder\" > myid",
                "cd ../../",
                "rm -f zookeeper-3.4.8.tar.gz"
            ]
        }
    ]

编辑 `host.txt` 内容如下：

    s35.white.shht.qihoo.net
    s36.white.shht.qihoo.net
    s37.white.shht.qihoo.net

运行如下命令：

    python deploygen.py jobs deploy.json host.txt > deploy.sh

则生成的脚本内容如下：

    #!/bin/sh
    ##############################################################################
    # NOTE : Generated by deploygen. It is NOT supposed to modify this file.
    ##############################################################################
    echo '[s35.white.shht.qihoo.net]...'
    
    sudo -u jobs \
        scp -oStrictHostKeyChecking=no \
        zookeeper-3.4.8.tar.gz \
        jobs@s35.white.shht.qihoo.net:/data/
    sudo -u jobs \
        ssh -oStrictHostKeyChecking=no \
        jobs@s35.white.shht.qihoo.net \
        ' \
        cd /data; \
        test -d zookeeper-3.4.8 && mv zookeeper-3.4.8 zookeeper-3.4.8-old; \
        tar -zxf zookeeper-3.4.8.tar.gz -C .; \
        '
    sudo -u jobs \
        scp -oStrictHostKeyChecking=no \
        zoo.cfg \
        jobs@s35.white.shht.qihoo.net:/data/zookeeper-3.4.8/conf/
    sudo -u jobs \
        ssh -oStrictHostKeyChecking=no \
        jobs@s35.white.shht.qihoo.net \
        ' \
        cd /data/zookeeper-3.4.8; \
        mkdir -p data; \
        cd data/; \
        echo "0" > myid; \
        cd ../../; \
        rm -f zookeeper-3.4.8.tar.gz; \
        '
    
    echo '[s36.white.shht.qihoo.net]...'
    
    sudo -u jobs \
        scp -oStrictHostKeyChecking=no \
        zookeeper-3.4.8.tar.gz \
        jobs@s36.white.shht.qihoo.net:/data/
    sudo -u jobs \
        ssh -oStrictHostKeyChecking=no \
        jobs@s36.white.shht.qihoo.net \
        ' \
        cd /data; \
        test -d zookeeper-3.4.8 && mv zookeeper-3.4.8 zookeeper-3.4.8-old; \
        tar -zxf zookeeper-3.4.8.tar.gz -C .; \
        '
    sudo -u jobs \
        scp -oStrictHostKeyChecking=no \
        zoo.cfg \
        jobs@s36.white.shht.qihoo.net:/data/zookeeper-3.4.8/conf/
    sudo -u jobs \
        ssh -oStrictHostKeyChecking=no \
        jobs@s36.white.shht.qihoo.net \
        ' \
        cd /data/zookeeper-3.4.8; \
        mkdir -p data; \
        cd data/; \
        echo "1" > myid; \
        cd ../../; \
        rm -f zookeeper-3.4.8.tar.gz; \
        '
    
    echo '[s37.white.shht.qihoo.net]...'
    
    sudo -u jobs \
        scp -oStrictHostKeyChecking=no \
        zookeeper-3.4.8.tar.gz \
        jobs@s37.white.shht.qihoo.net:/data/
    sudo -u jobs \
        ssh -oStrictHostKeyChecking=no \
        jobs@s37.white.shht.qihoo.net \
        ' \
        cd /data; \
        test -d zookeeper-3.4.8 && mv zookeeper-3.4.8 zookeeper-3.4.8-old; \
        tar -zxf zookeeper-3.4.8.tar.gz -C .; \
        '
    sudo -u jobs \
        scp -oStrictHostKeyChecking=no \
        zoo.cfg \
        jobs@s37.white.shht.qihoo.net:/data/zookeeper-3.4.8/conf/
    sudo -u jobs \
        ssh -oStrictHostKeyChecking=no \
        jobs@s37.white.shht.qihoo.net \
        ' \
        cd /data/zookeeper-3.4.8; \
        mkdir -p data; \
        cd data/; \
        echo "2" > myid; \
        cd ../../; \
        rm -f zookeeper-3.4.8.tar.gz; \
        '
    
    echo 'finish!'

可以看到， `@index_place_holder` 依次被替换为对应的序号。

[回上页](../deploygen.md)

[回首页](../../index.md)