<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>案例：hustdict</title>
    <link type="text/css" rel="stylesheet" href="../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/hljs-github.min.css"/>
  </head>
  <body>
    <article class="markdown-body"><h2 id="-hustdict"><a class="header-link" href="#-hustdict"></a>案例：hustdict</h2>
<h3 id="-"><a class="header-link" href="#-"></a>简介</h3>
<p><code>hustdict</code> 是基于 <code>hustngx</code> 开发的 <code>key-value</code> 缓存模块，同时也是 <a href="../advanced/lib_hustngx/core_module.html"><code>lib_ngx_shm_dict</code></a> 的测试套件。</p>
<h3 id="--1"><a class="header-link" href="#--1"></a>工程配置文件</h3>
<p>文件路径：<code>hustngx/sample/hustdict.json</code></p>
<pre class="hljs"><code>{
    "<span class="hljs-attribute">module</span>": <span class="hljs-value"><span class="hljs-string">"hustdict"</span></span>,
    "<span class="hljs-attribute">includes</span>": <span class="hljs-value">[<span class="hljs-string">"ngx_shm_dict"</span>]</span>,
    "<span class="hljs-attribute">main_conf</span>":
    <span class="hljs-value">[
        [<span class="hljs-string">"string"</span>, <span class="hljs-string">"shm_name"</span>],
        [<span class="hljs-string">"int"</span>, <span class="hljs-string">"shm_size"</span>]
    ]</span>,
    "<span class="hljs-attribute">handlers</span>":
    <span class="hljs-value">[
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"set"</span></span>, "<span class="hljs-attribute">action_for_request_body</span>": <span class="hljs-value"><span class="hljs-string">"read"</span></span>, "<span class="hljs-attribute">methods</span>": <span class="hljs-value">[<span class="hljs-string">"POST"</span>] </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"get"</span> </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"del"</span> </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"flush_all"</span> </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"flush_expired"</span> </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"keys"</span> </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"get_keys"</span> </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"incr"</span> </span>},
        { "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"decr"</span> </span>}
    ]
</span>}</code></pre><p>运行如下命令：</p>
<pre class="hljs"><code>python hustngx<span class="hljs-class">.py</span> nginx-<span class="hljs-number">1.9</span>.<span class="hljs-number">4</span><span class="hljs-class">.tar</span><span class="hljs-class">.gz</span> sample/hustdict.json</code></pre><p>即可生成对应的工程模板：<code>hustngx/sample/hustdict</code></p>
<p>之后的开发可以利用文本比对工具（例如：<code>BeyondCompare</code>），将生成的新代码同步至项目目录之中。</p>
<h3 id="nginx-"><a class="header-link" href="#nginx-"></a>nginx 配置文件</h3>
<p>文件路径：<code>hustngx/hustdict/nginx/conf/nginx.json</code></p>
<pre class="hljs"><code>{
    "<span class="hljs-attribute">module</span>": <span class="hljs-value"><span class="hljs-string">"hustdict"</span></span>,
    "<span class="hljs-attribute">worker_connections</span>": <span class="hljs-value"><span class="hljs-number">1048576</span></span>,
    "<span class="hljs-attribute">listen</span>": <span class="hljs-value"><span class="hljs-number">8085</span></span>,
    "<span class="hljs-attribute">keepalive_timeout</span>": <span class="hljs-value"><span class="hljs-number">540</span></span>,
    "<span class="hljs-attribute">keepalive</span>": <span class="hljs-value"><span class="hljs-number">32768</span></span>,
    "<span class="hljs-attribute">http_basic_auth_file</span>": <span class="hljs-value"><span class="hljs-string">"/home/search/hustdict/conf/htpasswd"</span></span>,
    "<span class="hljs-attribute">main_conf</span>":
    <span class="hljs-value">[
        [<span class="hljs-string">"shm_name"</span>, <span class="hljs-string">"hust_dict_share_memory"</span>],
        [<span class="hljs-string">"shm_size"</span>, <span class="hljs-string">"268435456"</span>]
    ]</span>,
    "<span class="hljs-attribute">auth_filter</span>": <span class="hljs-value">[]</span>,
    "<span class="hljs-attribute">local_cmds</span>": <span class="hljs-value">[<span class="hljs-string">"set"</span>, <span class="hljs-string">"get"</span>, <span class="hljs-string">"del"</span>, <span class="hljs-string">"flush_all"</span>, <span class="hljs-string">"flush_expired"</span>, <span class="hljs-string">"keys"</span>, <span class="hljs-string">"get_keys"</span>, <span class="hljs-string">"incr"</span>, <span class="hljs-string">"decr"</span>]
</span>}</code></pre><p>运行如下命令：</p>
<pre class="hljs"><code><span class="hljs-keyword">python</span> genconf.<span class="hljs-keyword">py</span></code></pre><p>即可生成对应的配置文件 <code>nginx.conf</code></p>
<h3 id="--2"><a class="header-link" href="#--2"></a>接口概要</h3>
<p><code>hustdict</code> 支持的值类型包括数字、字符串、二进制三类，具体参考：<a href="hustdict/types.html">值类型列表</a></p>
<p>以下是 <code>hustdict</code> 提供的 http 接口：</p>
<ul class="list">
<li><a href="hustdict/set.html">set</a></li>
<li><a href="hustdict/get.html">get</a></li>
<li><a href="hustdict/del.html">del</a></li>
<li><a href="hustdict/flush_all.html">flush_all</a></li>
<li><a href="hustdict/flush_expired.html">flush_expired</a></li>
<li><a href="hustdict/keys.html">keys</a></li>
<li><a href="hustdict/get_keys.html">get_keys</a></li>
<li><a href="hustdict/incr.html">incr</a></li>
<li><a href="hustdict/decr.html">decr</a></li>
</ul>
<h3 id="--3"><a class="header-link" href="#--3"></a>测试脚本</h3>
<ul class="list">
<li><p><code>autotest.py</code><br><code>hustdict</code> 单元测试脚本。</p>
</li>
<li><p><code>mutitest.py</code><br><code>hustdict</code> 压力测试脚本。</p>
</li>
<li><p><code>mutikill.sh</code><br>用于杀掉 <code>hustdict</code> 压力测试脚本进程。</p>
</li>
</ul>
<p><a href="./index.html">上一级</a></p>
<p><a href="../index.html">根目录</a></p>
    </article>
  </body>
</html>
