<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>Nginx 工程配置</title>
    <link type="text/css" rel="stylesheet" href="../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/hljs-github.min.css"/>
  </head>
  <body>
    <article class="markdown-body"><h2 id="nginx-"><a class="header-link" href="#nginx-"></a>Nginx 工程配置</h2>
<h3 id="-"><a class="header-link" href="#-"></a>编译选项</h3>
<pre class="hljs"><code><span class="hljs-attribute">[file]</span>
nginx/auto/cc/gcc

<span class="hljs-attribute">[key]</span>
<span class="hljs-code">......
# optimizations

#NGX_GCC_OPT="-O2"
#NGX_GCC_OPT="-Os"
NGX_GCC_OPT="-O"
......</span>
# debug
CFLAGS="$CFLAGS -g"
......</code></pre><p>如果需要关闭编译器优化，打开调试信息，可修改此文件。</p>
<h3 id="--1"><a class="header-link" href="#--1"></a>链接选项</h3>
<pre class="hljs"><code><span class="hljs-attribute">[file]</span>
nginx/auto/cc/conf

<span class="hljs-attribute">[key]</span>
<span class="hljs-code">......
LINK="\$(CC)"
......</span></code></pre><p>如果需要链接第三方库，可以修改此文件。</p>
<h3 id="--2"><a class="header-link" href="#--2"></a>安装选项</h3>
<pre class="hljs"><code><span class="hljs-attribute">[file]</span>
nginx/auto/install

<span class="hljs-attribute">[key]</span>
<span class="hljs-code">......
install:    $NGX_OBJS${ngx_dirsep}nginx${ngx_binext}
......</span></code></pre><p>如果需要在安装 nginx 时自定义文件拷贝的逻辑，可以修改此文件。</p>
<h3 id="--3"><a class="header-link" href="#--3"></a>第三方库集成</h3>
<pre class="hljs"><code><span class="hljs-attribute">[file]</span>
nginx/auto/sources

<span class="hljs-attribute">[key]</span>
<span class="hljs-code">......
CORE_DEPS="src/core/nginx.h \
......</span>
CORE<span class="hljs-emphasis">_SRCS="src/core/nginx.c \
......
HTTP_</span>DEPS="src/http/ngx<span class="hljs-emphasis">_http.h \
......
HTTP_</span>SRCS="src/http/ngx<span class="hljs-emphasis">_http.c \</span></code></pre><p>如果你引入的第三方库需要集成到 nginx 源代码中，可以修改此文件添加依赖关系。</p>
<h3 id="nginx--1"><a class="header-link" href="#nginx--1"></a>nginx 模块集成</h3>
<p>如果你想将自己编写的模块集成到 nginx 源代码中，你需要关注如下几个文件：</p>
<ul class="list">
<li><p><code>nginx/auto/options</code></p>
</li>
<li><p><code>nginx/auto/sources</code></p>
</li>
<li><p><code>nginx/auto/modules</code></p>
</li>
</ul>
<p><code>nginx/auto/options</code> 用于定义是否添加模块的编译：</p>
<pre class="hljs"><code><span class="hljs-attribute">[file]</span>
nginx/auto/options

<span class="hljs-attribute">[key]</span>
<span class="hljs-code">......
HTTP_AUTH_BASIC=YES
......</span></code></pre><p><code>nginx/auto/sources</code> 用于定义模块的名称以及源代码文件路径，例如：</p>
<pre class="hljs"><code><span class="hljs-attribute">[file]</span>
nginx/auto/sources
<span class="hljs-attribute">[key]</span>
<span class="hljs-code">......
HTTP_AUTH_BASIC_MODULE=ngx_http_auth_basic_module
HTTP_AUTH_BASIC_SRCS=src/http/modules/ngx_http_auth_basic_module.c
......</span></code></pre><p><code>nginx/auto/modules</code> 用于整合以上两个文件所增加的模块，例如：</p>
<pre class="hljs"><code>[file]
nginx/auto/modules

[key]
......
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$HTTP_AUTH_BASIC</span> = YES ]; <span class="hljs-keyword">then</span>
    USE_MD5=YES
    USE_SHA1=YES
    have=NGX_CRYPT . auto/have
    HTTP_MODULES=<span class="hljs-string">"<span class="hljs-variable">$HTTP_MODULES</span> <span class="hljs-variable">$HTTP_AUTH_BASIC_MODULE</span>"</span>
    HTTP_SRCS=<span class="hljs-string">"<span class="hljs-variable">$HTTP_SRCS</span> <span class="hljs-variable">$HTTP_AUTH_BASIC_SRCS</span>"</span>
    CORE_LIBS=<span class="hljs-string">"<span class="hljs-variable">$CORE_LIBS</span> <span class="hljs-variable">$CRYPT_LIB</span>"</span>
<span class="hljs-keyword">fi</span>
......</code></pre><p>其中这两句是关键：</p>
<pre class="hljs"><code>HTTP_MODULES=<span class="hljs-string">"<span class="hljs-variable">$HTTP_MODULES</span> <span class="hljs-variable">$HTTP_AUTH_BASIC_MODULE</span>"</span>
HTTP_SRCS=<span class="hljs-string">"<span class="hljs-variable">$HTTP_SRCS</span> <span class="hljs-variable">$HTTP_AUTH_BASIC_SRCS</span>"</span></code></pre><p><a href="./index.html">上一级</a></p>
<p><a href="../index.html">根目录</a></p>
    </article>
  </body>
</html>
