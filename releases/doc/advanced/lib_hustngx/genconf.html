<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>nginx 配置文件生成器</title>
    <link type="text/css" rel="stylesheet" href="../../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../../assets/css/hljs-github.min.css"/>
  </head>
  <body>
    <article class="markdown-body"><h2 id="nginx-"><a class="header-link" href="#nginx-"></a>nginx 配置文件生成器</h2>
<p><code>genconf</code> 用于自动生成 <code>nginx.conf</code> 文件，其输入参数通过配置文件设定。</p>
<p>工具路径：<code>hustngx/lib_hustngx/nginx/conf/genconf.py</code></p>
<p>使用范例：</p>
<pre class="hljs"><code>usage sample:
    python genconf<span class="hljs-class">.py</span> nginx.json</code></pre><p>以下是一个完整的配置文件，包含 <code>genconf</code> 所支持的所有字段：</p>
<pre class="hljs"><code>{
    "<span class="hljs-attribute">module</span>": <span class="hljs-value"><span class="hljs-string">"hustmqha"</span></span>,
    "<span class="hljs-attribute">worker_connections</span>": <span class="hljs-value"><span class="hljs-number">1048576</span></span>,
    "<span class="hljs-attribute">listen</span>": <span class="hljs-value"><span class="hljs-number">8080</span></span>,
    "<span class="hljs-attribute">keepalive_timeout</span>": <span class="hljs-value"><span class="hljs-number">540</span></span>,
    "<span class="hljs-attribute">keepalive</span>": <span class="hljs-value"><span class="hljs-number">32768</span></span>,
    "<span class="hljs-attribute">http_basic_auth_file</span>": <span class="hljs-value"><span class="hljs-string">"/home/search/hustmqha/conf/htpasswd"</span></span>,
    "<span class="hljs-attribute">nginx_root</span>": <span class="hljs-value"><span class="hljs-string">"/home/search/hustmqha/html"</span></span>,
    "<span class="hljs-attribute">auth_filter</span>": <span class="hljs-value">[<span class="hljs-string">"test"</span>]</span>,
    "<span class="hljs-attribute">local_cmds</span>": <span class="hljs-value">[<span class="hljs-string">"getconf"</span>, <span class="hljs-string">"test"</span>]</span>,
    "<span class="hljs-attribute">main_conf</span>": 
    <span class="hljs-value">[
        [<span class="hljs-string">"long_polling_timeout"</span>, <span class="hljs-string">"180s"</span>],
        [<span class="hljs-string">"status_cache"</span>, <span class="hljs-string">"off"</span>],
        [<span class="hljs-string">"keepalive_cache_size"</span>, <span class="hljs-number">128</span>],
        [<span class="hljs-string">"autost_uri"</span>, <span class="hljs-string">"/hustmq/stat_all"</span>],
        [<span class="hljs-string">"fetch_buffer_size"</span>, <span class="hljs-string">"64m"</span>],
        [<span class="hljs-string">"autost_interval"</span>, <span class="hljs-string">"200ms"</span>]
    ]</span>,
    "<span class="hljs-attribute">proxy</span>":
    <span class="hljs-value">{
        "<span class="hljs-attribute">health_check</span>": 
        <span class="hljs-value">[
            <span class="hljs-string">"check interval=5000 rise=1 fall=3 timeout=5000 type=http"</span>,
            <span class="hljs-string">"check_http_send \"GET /status.html HTTP/1.1\\r\\n\\r\\n\""</span>,
            <span class="hljs-string">"check_http_expect_alive http_2xx"</span>
        ]</span>,
        "<span class="hljs-attribute">auth</span>": <span class="hljs-value"><span class="hljs-string">"aHVzdGRieGM6cWlob29odXN0eHJiY3pkYg=="</span></span>,
        "<span class="hljs-attribute">proxy_connect_timeout</span>": <span class="hljs-value"><span class="hljs-string">"2s"</span></span>,
        "<span class="hljs-attribute">proxy_send_timeout</span>": <span class="hljs-value"><span class="hljs-string">"60s"</span></span>,
        "<span class="hljs-attribute">proxy_read_timeout</span>": <span class="hljs-value"><span class="hljs-string">"60s"</span></span>,
        "<span class="hljs-attribute">proxy_buffer_size</span>": <span class="hljs-value"><span class="hljs-string">"64m"</span></span>,
        "<span class="hljs-attribute">backends</span>": <span class="hljs-value">[<span class="hljs-string">"backend:8087"</span>]</span>,
        "<span class="hljs-attribute">proxy_cmds</span>": <span class="hljs-value">[<span class="hljs-string">"/backend/test"</span>]
    </span>}
</span>}</code></pre><p><strong>其中必填的字段包括：</strong></p>
<ul class="list">
<li><p><code>module</code>： 模块名称</p>
</li>
<li><p><code>worker_connections</code>: <code>worker</code> 进程处理的最大连接数</p>
</li>
<li><p><code>listen</code>: 监听端口</p>
</li>
<li><p><code>local_cmds</code>: 模块支持的命令列表</p>
</li>
</ul>
<p><strong>除此之外的其他字段都是可选的</strong>。</p>
<p>其中 <code>local_cmds</code> 表示模块所支持的命令列表，每一条命令的含义等同于 <a href="../ngx_wizard/uri.html">ngx_wizard 配置文件中所定义的 uri</a></p>
<p>大部分可选字段的含义以及配置方法和 nginx 官方的配置文件的含义一致，包括：</p>
<ul class="list">
<li><p><code>keepalive_timeout</code></p>
</li>
<li><p><code>keepalive</code></p>
</li>
<li><p><code>proxy_connect_timeout</code></p>
</li>
<li><p><code>proxy_send_timeout</code></p>
</li>
<li><p><code>proxy_read_timeout</code></p>
</li>
<li><p><code>proxy_buffer_size</code></p>
</li>
</ul>
<p><code>health_check</code> 的配置可参考 <a href="https://github.com/yaoweibin/nginx_upstream_check_module"><code>nginx_upstream_check_module</code></a></p>
<p>以下是自定义的可选字段：</p>
<p><a href="./http_basic_auth_file.html"><code>http_basic_auth_file</code></a><br><a href="./nginx_root.html"><code>nginx_root</code></a><br><a href="./auth_filter.html"><code>auth_filter</code></a><br><a href="./main_conf.html"><code>main_conf</code></a><br><a href="./proxy.html"><code>proxy</code></a><br>　　<a href="./auth.html"><code>auth</code></a><br>　　<a href="./backends.html"><code>backends</code></a><br>　　<a href="./proxy_cmds.html"><code>proxy_cmds</code></a>  </p>
<p><a href="../lib_hustngx.html">上一级</a></p>
<p><a href="../../index.html">根目录</a></p>
    </article>
  </body>
</html>
